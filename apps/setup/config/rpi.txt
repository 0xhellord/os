/*++

Copyright (c) 2015 Minoca Corp. All Rights Reserved

Module Name:

    rpi.txt

Abstract:

    This module implements the setup recipe for Raspberry Pi.

Author:

    Evan Green 19-Oct-2015

Environment:

    Setup

--*/

DriverFiles += DriverFilesArm;
DriverFiles += [
    "dwhci.drv",
    "sdbm2709.drv",
];

BootDrivers += [
    "sdbm2709.drv",
];

RpiFirmwareFiles = [
    "rpifw",
    "config.txt",
    "start.elf",
    "fixup.dat",
    "bootcode.bin"
];

//
// Copy the firmware to the system partition for recovery if needed.
//

RpiFirmwareSystemCopy = {
    "Destination": SystemDir + "rpi/",
    "Source": "./",
    "SourceVolume": 0,
    "Files": RpiFirmwareFiles
};

//
// Copy the firmware to the boot partition.
//

RpiFirmwareCopy = {
    "Destination": "/",
    "Source": "./",
    "SourceVolume": 0,
    "Files": RpiFirmwareFiles
};

TotalCopy += [RpiFirmwareSystemCopy];
TotalBootCopy += [RpiFirmwareCopy];
DiskData["Format"] = PARTITION_FORMAT_MBR;

//
// Set the EFI boot manager name.
//

BootmefiCopy["Destination"] += EFI_DEFAULT_APP_ARM;
BootPartition["Alignment"] = 1 * MEGABYTE;
